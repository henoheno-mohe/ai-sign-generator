{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/naoki/Projects/ai-sign-generator/neon-sign-maker/src/lib/neonProtocol.ts"],"sourcesContent":["import type { BackgroundTemplate } from \"@/lib/backgrounds\";\nimport type { NeonColor } from \"@/lib/palette\";\n\n/**\n * Neon Sign Protocol (v1)\n * 目的: 「いわゆるネオンサイン」の実物仕上がりに寄せた生成指示を統一する\n *\n * 前提（ユーザー要件）\n * - 屋内限定\n * - 単線（1本チューブ表現）\n * - 発光幅: φ5 / φ7 / φ9 mm のネオンチューブで構成\n * - 透明アクリルパネルで挟み込み（表裏） + 四隅スタンドオフ金具\n * - 14色パレットから最大3色（主色1＋アクセント2）\n */\n\nexport type TubeDiameter = 5 | 7 | 9;\n\nexport const NEON_PROTOCOL_V1 = {\n  productName: \"屋内ネオンサイン（アクリルパネル挟み込み）\",\n  tubeDiameters: [5, 7, 9] as const,\n  defaultTubeDiameter: 7 as const,\n  maxColors: 3,\n  paletteSize: 14,\n} as const;\n\nexport function buildNeonPrompt({\n  userText,\n  colors,\n  background,\n  widthMm,\n  tubeDiameter,\n}: {\n  userText: string;\n  colors: NeonColor[]; // 1..5\n  background: BackgroundTemplate;\n  widthMm: number; // target overall width in mm\n  tubeDiameter: TubeDiameter;\n}) {\n  const text = userText.trim();\n  const colorList = colors\n    .slice(0, 5)\n    .map((c, i) => `- Color ${i + 1}: ${c.name} (${c.hex})`)\n    .join(\"\\n\");\n  const targetWidth = Math.max(200, Math.min(2000, Math.round(widthMm)));\n\n  // 画像生成モデル向けに、英語で「商品写真っぽさ」を強く指示（日本語だけより安定しやすい）\n  return `CRITICAL TASK:\nGenerate a photorealistic product photo of an indoor neon sign installation (NOT a mockup illustration).\n\nSCENE (DEFAULT):\n- Night-time indoor scene.\n- Warm ambient lighting (approx 2700K–3000K). Cozy warm tone.\n- The neon sign should be the main highlight light source, with soft warm room fill.\n\nPRODUCT MUST MATCH:\n- LED neon flex / neon tube sign, single-stroke look, uniform tube thickness.\n- Tube diameter / glow width: approximately φ${tubeDiameter}mm.\n- Mounted using clear acrylic panels (front + back acrylic sandwich).\n- Visible standoff hardware: 4 round standoff caps / screws at the corners.\n- The acrylic panel is slightly offset from the wall, with subtle realistic shadows.\n- Real-world scale: the overall sign width should be approximately ${targetWidth}mm.\n- Height should be auto-determined by the design (logo/text) while keeping natural proportions.\n- Acrylic panel size should fit the design with reasonable margins (do not crop the design).\n\nLIGHTING:\n- Realistic neon glow + soft halo on the wall.\n- NO excessive lens flare, NO fake bokeh, keep it like a clean product photo.\n- Keep colors accurate and vivid, but not oversaturated.\n- Keep the wall and room lighting warm (night warm ambience), matching the scene requirements.\n- The neon tube MUST look emissive: bright luminous core + diffused outer glow.\n- IMPORTANT: Do NOT look like printed/painted lines on acrylic. It must be a real glowing tube.\n\nCOLOR RULES (use ONLY these 3 colors; distribution is up to you):\nCOLOR RULES (use ONLY these colors; do not introduce any additional colors):\n${colorList}\n\nBACKGROUND:\n- Use this wall style: ${background.name} (${background.description})\n- Warm indoor wall lighting, realistic texture, subtle noise/grain like a real camera photo.\n\nDO NOT:\n- Do not change the content/shape provided by the input (no redesign).\n- Do not turn it into channel letters or box letters.\n- Do not add extra objects (bulbs, random decorations, unrelated logos).\n\nOUTPUT:\n- One realistic installed neon sign photo on the wall.\n${text ? `\\nTEXT (optional input, keep exact):\\n${text}\\n` : \"\"}`.trim();\n}\n\n\n"],"names":[],"mappings":";;;;;;AAiBO,MAAM,mBAAmB;IAC9B,aAAa;IACb,eAAe;QAAC;QAAG;QAAG;KAAE;IACxB,qBAAqB;IACrB,WAAW;IACX,aAAa;AACf;AAEO,SAAS,gBAAgB,EAC9B,QAAQ,EACR,MAAM,EACN,UAAU,EACV,OAAO,EACP,YAAY,EAOb;IACC,MAAM,OAAO,SAAS,IAAI;IAC1B,MAAM,YAAY,OACf,KAAK,CAAC,GAAG,GACT,GAAG,CAAC,CAAC,GAAG,IAAM,CAAC,QAAQ,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,EACtD,IAAI,CAAC;IACR,MAAM,cAAc,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,MAAM,KAAK,KAAK,CAAC;IAE5D,8CAA8C;IAC9C,OAAO,CAAC;;;;;;;;;;6CAUmC,EAAE,aAAa;;;;mEAIO,EAAE,YAAY;;;;;;;;;;;;;;AAcjF,EAAE,UAAU;;;uBAGW,EAAE,WAAW,IAAI,CAAC,EAAE,EAAE,WAAW,WAAW,CAAC;;;;;;;;;;AAUpE,EAAE,OAAO,CAAC,sCAAsC,EAAE,KAAK,EAAE,CAAC,GAAG,IAAI,CAAC,IAAI;AACtE"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///Users/naoki/Projects/ai-sign-generator/neon-sign-maker/src/lib/backgrounds.ts"],"sourcesContent":["export type BackgroundTemplate = {\n  id: \"brick\" | \"whitewall\" | \"concrete\";\n  name: string;\n  description: string;\n  className: string; // Tailwind-compatible utility string\n};\n\nexport const BACKGROUND_TEMPLATES: BackgroundTemplate[] = [\n  {\n    id: \"brick\",\n    name: \"レンガ\",\n    description: \"バー/ゲーム部屋っぽい\",\n    className:\n      \"bg-[radial-gradient(circle_at_20%_20%,rgba(255,255,255,0.08),transparent_45%),repeating-linear-gradient(0deg,rgba(255,255,255,0.06),rgba(255,255,255,0.06)_2px,transparent_2px,transparent_24px),repeating-linear-gradient(90deg,rgba(255,255,255,0.05),rgba(255,255,255,0.05)_2px,transparent_2px,transparent_48px)] bg-[#2a1b13]\"\n  },\n  {\n    id: \"whitewall\",\n    name: \"白壁\",\n    description: \"部屋/ギフトに合わせやすい\",\n    className:\n      \"bg-[radial-gradient(circle_at_30%_20%,rgba(0,0,0,0.04),transparent_45%),linear-gradient(180deg,#f7f7f7,#eaeaea)]\"\n  },\n  {\n    id: \"concrete\",\n    name: \"コンクリ\",\n    description: \"クール/都会っぽい\",\n    className:\n      \"bg-[radial-gradient(circle_at_30%_25%,rgba(255,255,255,0.10),transparent_55%),repeating-linear-gradient(45deg,rgba(255,255,255,0.06),rgba(255,255,255,0.06)_2px,transparent_2px,transparent_18px)] bg-[#35393f]\"\n  }\n];\n\n// MVP: 設置イメージは1枚でOK（白壁をデフォルトにする）\nexport const DEFAULT_BACKGROUND_ID: BackgroundTemplate[\"id\"] = \"whitewall\";\n\nexport function getDefaultBackground(): BackgroundTemplate {\n  return BACKGROUND_TEMPLATES.find((t) => t.id === DEFAULT_BACKGROUND_ID) ?? BACKGROUND_TEMPLATES[0];\n}\n\n\n"],"names":[],"mappings":";;;;;;;;AAOO,MAAM,uBAA6C;IACxD;QACE,IAAI;QACJ,MAAM;QACN,aAAa;QACb,WACE;IACJ;IACA;QACE,IAAI;QACJ,MAAM;QACN,aAAa;QACb,WACE;IACJ;IACA;QACE,IAAI;QACJ,MAAM;QACN,aAAa;QACb,WACE;IACJ;CACD;AAGM,MAAM,wBAAkD;AAExD,SAAS;IACd,OAAO,qBAAqB,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,0BAA0B,oBAAoB,CAAC,EAAE;AACpG"}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///Users/naoki/Projects/ai-sign-generator/neon-sign-maker/src/lib/nanoBananaCompat.ts"],"sourcesContent":["// neon-sign-maker: 既存プロジェクトと同じモデル/URLを流用\nexport const NANO_BANANA_IMAGE_API_URL =\n  \"https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-image-preview:generateContent\";\n\n\n"],"names":[],"mappings":"AAAA,yCAAyC;;;;;AAClC,MAAM,4BACX"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///Users/naoki/Projects/ai-sign-generator/neon-sign-maker/src/lib/geminiImage.ts"],"sourcesContent":["import { NANO_BANANA_IMAGE_API_URL } from \"./nanoBananaCompat\";\n\ntype GeminiImageResult = {\n  imageDataUrl: string;\n  text?: string;\n};\n\nfunction cleanApiKey(apiKey: string) {\n  return apiKey.replace(/[\"'`]/g, \"\").replace(/[^\\x00-\\x7F]/g, \"\").trim();\n}\n\nexport async function generateImageWithGemini({\n  apiKey,\n  prompt,\n  inputImageBase64,\n  inputMimeType = \"image/png\",\n}: {\n  apiKey: string;\n  prompt: string;\n  inputImageBase64?: string | null;\n  inputMimeType?: string;\n}): Promise<GeminiImageResult> {\n  const cleanKey = cleanApiKey(apiKey);\n\n  const parts: Array<Record<string, unknown>> = [];\n  if (inputImageBase64) {\n    parts.push({\n      inline_data: {\n        mime_type: inputMimeType,\n        data: inputImageBase64,\n      },\n    });\n  }\n  parts.push({ text: prompt });\n\n  const requestBody = {\n    contents: [{ parts }],\n    generationConfig: {\n      temperature: 0.2,\n      topK: 32,\n      topP: 1,\n      maxOutputTokens: 4096,\n    },\n  };\n\n  const resp = await fetch(NANO_BANANA_IMAGE_API_URL, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"x-goog-api-key\": cleanKey,\n    },\n    body: JSON.stringify(requestBody),\n  });\n\n  if (!resp.ok) {\n    const errorText = await resp.text().catch(() => \"\");\n    throw new Error(`Gemini API Error: ${resp.status} ${resp.statusText} ${errorText}`);\n  }\n\n  const data = await resp.json();\n  const candidate = data?.candidates?.[0];\n  const partsOut = candidate?.content?.parts;\n\n  let textOut = \"\";\n  if (Array.isArray(partsOut)) {\n    for (const p of partsOut) {\n      if (p?.text) textOut += String(p.text);\n    }\n  }\n\n  if (Array.isArray(partsOut)) {\n    for (const p of partsOut) {\n      const inline = p?.inline_data || p?.inlineData;\n      if (inline?.data) {\n        const mime = inline?.mime_type || inline?.mimeType || \"image/png\";\n        return { imageDataUrl: `data:${mime};base64,${inline.data}`, text: textOut || undefined };\n      }\n    }\n  }\n\n  throw new Error(\"Gemini API did not return image data.\");\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;;AAOA,SAAS,YAAY,MAAc;IACjC,OAAO,OAAO,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,iBAAiB,IAAI,IAAI;AACvE;AAEO,eAAe,wBAAwB,EAC5C,MAAM,EACN,MAAM,EACN,gBAAgB,EAChB,gBAAgB,WAAW,EAM5B;IACC,MAAM,WAAW,YAAY;IAE7B,MAAM,QAAwC,EAAE;IAChD,IAAI,kBAAkB;QACpB,MAAM,IAAI,CAAC;YACT,aAAa;gBACX,WAAW;gBACX,MAAM;YACR;QACF;IACF;IACA,MAAM,IAAI,CAAC;QAAE,MAAM;IAAO;IAE1B,MAAM,cAAc;QAClB,UAAU;YAAC;gBAAE;YAAM;SAAE;QACrB,kBAAkB;YAChB,aAAa;YACb,MAAM;YACN,MAAM;YACN,iBAAiB;QACnB;IACF;IAEA,MAAM,OAAO,MAAM,MAAM,sLAAyB,EAAE;QAClD,QAAQ;QACR,SAAS;YACP,gBAAgB;YAChB,kBAAkB;QACpB;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,KAAK,EAAE,EAAE;QACZ,MAAM,YAAY,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,IAAM;QAChD,MAAM,IAAI,MAAM,CAAC,kBAAkB,EAAE,KAAK,MAAM,CAAC,CAAC,EAAE,KAAK,UAAU,CAAC,CAAC,EAAE,WAAW;IACpF;IAEA,MAAM,OAAO,MAAM,KAAK,IAAI;IAC5B,MAAM,YAAY,MAAM,YAAY,CAAC,EAAE;IACvC,MAAM,WAAW,WAAW,SAAS;IAErC,IAAI,UAAU;IACd,IAAI,MAAM,OAAO,CAAC,WAAW;QAC3B,KAAK,MAAM,KAAK,SAAU;YACxB,IAAI,GAAG,MAAM,WAAW,OAAO,EAAE,IAAI;QACvC;IACF;IAEA,IAAI,MAAM,OAAO,CAAC,WAAW;QAC3B,KAAK,MAAM,KAAK,SAAU;YACxB,MAAM,SAAS,GAAG,eAAe,GAAG;YACpC,IAAI,QAAQ,MAAM;gBAChB,MAAM,OAAO,QAAQ,aAAa,QAAQ,YAAY;gBACtD,OAAO;oBAAE,cAAc,CAAC,KAAK,EAAE,KAAK,QAAQ,EAAE,OAAO,IAAI,EAAE;oBAAE,MAAM,WAAW;gBAAU;YAC1F;QACF;IACF;IAEA,MAAM,IAAI,MAAM;AAClB"}},
    {"offset": {"line": 236, "column": 0}, "map": {"version":3,"sources":["file:///Users/naoki/Projects/ai-sign-generator/neon-sign-maker/src/app/api/neon/generate/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { NEON_PROTOCOL_V1 } from \"@/lib/neonProtocol\";\nimport { getDefaultBackground } from \"@/lib/backgrounds\";\nimport { generateImageWithGemini } from \"@/lib/geminiImage\";\nimport { buildNeonPrompt } from \"@/lib/neonProtocol\";\nimport type { NeonColor } from \"@/lib/palette\";\n\nfunction getApiKey() {\n  // 既存のキー名を流用（将来はサーバー用キーに分離推奨）\n  return process.env.NANO_BANANA_API_KEY || process.env.NEXT_PUBLIC_NANO_BANANA_API_KEY || \"\";\n}\n\nfunction dataUrlToBase64(dataUrl: string) {\n  const match = dataUrl.match(/^data:(.+);base64,(.*)$/);\n  if (!match) return null;\n  return { mimeType: match[1], base64: match[2] };\n}\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json();\n    const apiKey = getApiKey();\n    if (!apiKey) {\n      return NextResponse.json(\n        { error: \"APIキーが設定されていません（環境変数 NANO_BANANA_API_KEY を設定してください）\" },\n        { status: 400 }\n      );\n    }\n\n    const sketchDataUrl: string | null | undefined = body?.sketchDataUrl ?? null;\n    const text: string = body?.text ?? \"\";\n    const colors: NeonColor[] = body?.colors;\n    const widthMm: number = body?.widthMm ?? 600;\n    const tubeDiameter: 5 | 7 | 9 = body?.tubeDiameter ?? NEON_PROTOCOL_V1.defaultTubeDiameter;\n\n    if (!Array.isArray(colors) || colors.length < 1 || colors.length > 5) {\n      return NextResponse.json({ error: \"色数の指定が不正です（1〜5色）\" }, { status: 400 });\n    }\n    if (colors.some((c) => !c?.hex || !c?.name)) {\n      return NextResponse.json({ error: \"色の指定が不正です\" }, { status: 400 });\n    }\n\n    const background = getDefaultBackground(); // MVP: 背景は1つ\n    const prompt = buildNeonPrompt({\n      userText: text,\n      colors,\n      background,\n      widthMm,\n      tubeDiameter,\n    });\n\n    const parsed = sketchDataUrl ? dataUrlToBase64(sketchDataUrl) : null;\n\n    const result = await generateImageWithGemini({\n      apiKey,\n      prompt,\n      inputImageBase64: parsed?.base64 ?? null,\n      inputMimeType: parsed?.mimeType ?? \"image/png\",\n    });\n\n    return NextResponse.json({ imageDataUrl: result.imageDataUrl, text: result.text });\n  } catch (e) {\n    const msg = e instanceof Error ? e.message : \"Unknown error\";\n    return NextResponse.json({ error: msg }, { status: 500 });\n  }\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;AAIA,SAAS;IACP,6BAA6B;IAC7B,OAAO,QAAQ,GAAG,CAAC,mBAAmB,IAAI,QAAQ,GAAG,CAAC,+BAA+B,IAAI;AAC3F;AAEA,SAAS,gBAAgB,OAAe;IACtC,MAAM,QAAQ,QAAQ,KAAK,CAAC;IAC5B,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO;QAAE,UAAU,KAAK,CAAC,EAAE;QAAE,QAAQ,KAAK,CAAC,EAAE;IAAC;AAChD;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,SAAS;QACf,IAAI,CAAC,QAAQ;YACX,OAAO,yKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsD,GAC/D;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,gBAA2C,MAAM,iBAAiB;QACxE,MAAM,OAAe,MAAM,QAAQ;QACnC,MAAM,SAAsB,MAAM;QAClC,MAAM,UAAkB,MAAM,WAAW;QACzC,MAAM,eAA0B,MAAM,gBAAgB,yKAAgB,CAAC,mBAAmB;QAE1F,IAAI,CAAC,MAAM,OAAO,CAAC,WAAW,OAAO,MAAM,GAAG,KAAK,OAAO,MAAM,GAAG,GAAG;YACpE,OAAO,yKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QACA,IAAI,OAAO,IAAI,CAAC,CAAC,IAAM,CAAC,GAAG,OAAO,CAAC,GAAG,OAAO;YAC3C,OAAO,yKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QACjE;QAEA,MAAM,aAAa,IAAA,4KAAoB,KAAI,aAAa;QACxD,MAAM,SAAS,IAAA,wKAAe,EAAC;YAC7B,UAAU;YACV;YACA;YACA;YACA;QACF;QAEA,MAAM,SAAS,gBAAgB,gBAAgB,iBAAiB;QAEhE,MAAM,SAAS,MAAM,IAAA,+KAAuB,EAAC;YAC3C;YACA;YACA,kBAAkB,QAAQ,UAAU;YACpC,eAAe,QAAQ,YAAY;QACrC;QAEA,OAAO,yKAAY,CAAC,IAAI,CAAC;YAAE,cAAc,OAAO,YAAY;YAAE,MAAM,OAAO,IAAI;QAAC;IAClF,EAAE,OAAO,GAAG;QACV,MAAM,MAAM,aAAa,QAAQ,EAAE,OAAO,GAAG;QAC7C,OAAO,yKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAI,GAAG;YAAE,QAAQ;QAAI;IACzD;AACF"}}]
}